{% extends 'base.html' %}

{% block title %}Practice Problems | Elevo{% endblock %}

{% block content %}
<section class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
  <div class="mb-6 flex flex-col gap-3 sm:flex-row sm:items-end sm:justify-between">
    <div>
      <p class="text-xs uppercase tracking-[0.16em] text-sky-300 font-semibold">Practice Module</p>
      <h1 class="text-3xl sm:text-4xl font-bold text-white">Coding Problems</h1>
      <p class="text-slate-300 mt-2">Fast filtering, clear status, and direct jump into solving.</p>
    </div>
    <div class="grid grid-cols-2 gap-3 text-sm">
      <div class="rounded-xl border border-sky-400/25 bg-sky-500/10 px-4 py-3">
        <p class="text-sky-200">Total Problems</p>
        <p class="text-2xl font-bold text-white">{{ total_problems }}</p>
      </div>
      <div class="rounded-xl border border-emerald-400/25 bg-emerald-500/10 px-4 py-3">
        <p class="text-emerald-200">Page</p>
        <p class="text-2xl font-bold text-white">{{ page_obj.number }}/{{ page_obj.paginator.num_pages }}</p>
      </div>
    </div>
  </div>

  <form method="get" class="rounded-2xl border border-slate-700 bg-slate-900/70 backdrop-blur p-4 mb-6">
    <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-6 gap-3">
      <div>
        <label class="block text-xs text-slate-400 mb-1">Search</label>
        {{ filter_form.search }}
      </div>
      <div>
        <label class="block text-xs text-slate-400 mb-1">Difficulty</label>
        {{ filter_form.difficulty }}
      </div>
      <div>
        <label class="block text-xs text-slate-400 mb-1">Topic</label>
        {{ filter_form.topic }}
      </div>
      <div>
        <label class="block text-xs text-slate-400 mb-1">Company</label>
        {{ filter_form.company }}
      </div>
      <div>
        <label class="block text-xs text-slate-400 mb-1">Status</label>
        {{ filter_form.status }}
      </div>
      <div class="flex items-end gap-2">
        <button type="submit" class="w-full py-3 rounded-xl bg-gradient-to-r from-sky-600 to-teal-600 hover:from-sky-700 hover:to-teal-700 text-white font-semibold">Apply</button>
        <a href="{% url 'practice:problem-list' %}" class="px-4 py-3 rounded-xl border border-slate-600 text-slate-300 hover:border-teal-400 hover:text-teal-300">Reset</a>
      </div>
    </div>
  </form>

  <div class="rounded-2xl border border-slate-700 overflow-hidden bg-slate-900/60">
    <div class="overflow-x-auto">
      <table class="w-full min-w-[860px]">
        <thead class="bg-slate-800/80 text-slate-300 text-xs uppercase tracking-wide">
          <tr>
            <th class="px-4 py-3 text-left">Problem</th>
            <th class="px-4 py-3 text-left">Difficulty</th>
            <th class="px-4 py-3 text-left">Topics</th>
            <th class="px-4 py-3 text-left">Companies</th>
            <th class="px-4 py-3 text-left">Acceptance</th>
            {% if user.is_authenticated %}<th class="px-4 py-3 text-left">Your Status</th>{% endif %}
            <th class="px-4 py-3 text-right">Action</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-slate-800 text-sm">
          {% for problem in page_obj %}
          <tr class="hover:bg-slate-800/40 transition-colors">
            <td class="px-4 py-4">
              <a href="{% url 'practice:problem_detail' problem.slug %}" class="text-white font-semibold hover:text-teal-300 transition-colors">
                {{ problem.problem_number }}. {{ problem.title }}
              </a>
            </td>
            <td class="px-4 py-4">
              {% if problem.difficulty == 'easy' %}
                <span class="px-2.5 py-1 rounded-full text-xs font-semibold bg-emerald-500/15 text-emerald-300 border border-emerald-500/30">Easy</span>
              {% elif problem.difficulty == 'medium' %}
                <span class="px-2.5 py-1 rounded-full text-xs font-semibold bg-yellow-500/15 text-yellow-300 border border-yellow-500/30">Medium</span>
              {% else %}
                <span class="px-2.5 py-1 rounded-full text-xs font-semibold bg-red-500/15 text-red-300 border border-red-500/30">Hard</span>
              {% endif %}
            </td>
            <td class="px-4 py-4">
              <div class="flex flex-wrap gap-1.5">
                {% for t in problem.topics.all|slice:":3" %}
                  <span class="px-2 py-1 rounded-lg text-xs bg-slate-800 border border-slate-600 text-slate-300">{{ t.name }}</span>
                {% empty %}
                  <span class="text-slate-500 text-xs">-</span>
                {% endfor %}
              </div>
            </td>
            <td class="px-4 py-4">
              <div class="flex flex-wrap gap-1.5">
                {% for c in problem.companies.all|slice:":2" %}
                  <span class="px-2 py-1 rounded-lg text-xs bg-slate-800 border border-slate-600 text-slate-300">{{ c.name }}</span>
                {% empty %}
                  <span class="text-slate-500 text-xs">-</span>
                {% endfor %}
              </div>
            </td>
            <td class="px-4 py-4 text-slate-300 font-medium">{{ problem.acceptance_rate }}%</td>
            {% if user.is_authenticated %}
            <td class="px-4 py-4">
              {% if problem.user_status == 'solved' %}
                <span class="px-2.5 py-1 rounded-full text-xs font-semibold bg-emerald-500/15 text-emerald-300 border border-emerald-500/30">Solved</span>
              {% elif problem.user_status == 'attempted' %}
                <span class="px-2.5 py-1 rounded-full text-xs font-semibold bg-sky-500/15 text-sky-300 border border-sky-500/30">Attempted</span>
              {% else %}
                <span class="px-2.5 py-1 rounded-full text-xs font-semibold bg-slate-700/50 text-slate-300 border border-slate-600">Not Attempted</span>
              {% endif %}
            </td>
            {% endif %}
            <td class="px-4 py-4 text-right">
              <a href="{% url 'practice:problem_detail' problem.slug %}" class="inline-flex items-center gap-1 px-3 py-2 rounded-lg bg-gradient-to-r from-sky-600 to-teal-600 hover:from-sky-700 hover:to-teal-700 text-white font-semibold">
                Solve <i class="ri-arrow-right-line"></i>
              </a>
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="{% if user.is_authenticated %}7{% else %}6{% endif %}" class="px-6 py-12 text-center text-slate-400">
              No problems matched your filters.
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  {% if page_obj.paginator.num_pages > 1 %}
  <div class="mt-6 flex items-center justify-between text-sm">
    <div class="text-slate-400">Showing {{ page_obj.start_index }}-{{ page_obj.end_index }} of {{ page_obj.paginator.count }}</div>
    <div class="flex items-center gap-2">
      {% if page_obj.has_previous %}
        <a href="?page={{ page_obj.previous_page_number }}{% if request.GET.search %}&search={{ request.GET.search|urlencode }}{% endif %}{% if request.GET.difficulty %}&difficulty={{ request.GET.difficulty }}{% endif %}{% if request.GET.topic %}&topic={{ request.GET.topic }}{% endif %}{% if request.GET.company %}&company={{ request.GET.company }}{% endif %}{% if request.GET.status %}&status={{ request.GET.status }}{% endif %}" class="px-3 py-2 rounded-lg border border-slate-600 text-slate-300 hover:border-teal-400 hover:text-teal-300">Previous</a>
      {% endif %}
      <span class="px-3 py-2 rounded-lg bg-slate-800 text-slate-200">{{ page_obj.number }}</span>
      {% if page_obj.has_next %}
        <a href="?page={{ page_obj.next_page_number }}{% if request.GET.search %}&search={{ request.GET.search|urlencode }}{% endif %}{% if request.GET.difficulty %}&difficulty={{ request.GET.difficulty }}{% endif %}{% if request.GET.topic %}&topic={{ request.GET.topic }}{% endif %}{% if request.GET.company %}&company={{ request.GET.company }}{% endif %}{% if request.GET.status %}&status={{ request.GET.status }}{% endif %}" class="px-3 py-2 rounded-lg border border-slate-600 text-slate-300 hover:border-teal-400 hover:text-teal-300">Next</a>
      {% endif %}
    </div>
  </div>
  {% endif %}
</section>
{% endblock %}
