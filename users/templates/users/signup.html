{% extends 'base.html' %}
{% load form_filters %}

{% block title %}Create Account | Elevo{% endblock %}

{% block content %}
<section class="min-h-screen px-4 py-10 sm:px-6 lg:px-8">
  <div class="mx-auto grid w-full max-w-6xl gap-8 lg:grid-cols-5">
    <aside class="dark-card rounded-2xl border border-white/10 p-6 lg:col-span-2">
      <p class="text-xs font-semibold uppercase tracking-[0.2em] text-sky-300">Welcome to Elevo</p>
      <h1 class="mt-3 text-3xl font-bold text-white brand-font">Build interview confidence, step by step.</h1>
      <p class="mt-3 text-sm leading-6 text-slate-300">
        Join as a student to practice coding, aptitude, and AI interviews. Join as a tutor to manage question banks and review interview sessions.
      </p>

      <div class="mt-6 space-y-3">
        <div class="rounded-xl border border-slate-700/60 bg-slate-900/40 p-4">
          <p class="text-sm font-semibold text-slate-100">Student Account</p>
          <p class="mt-1 text-xs text-slate-400">Access coding practice, aptitude tracks, and mock interviews.</p>
        </div>
        <div class="rounded-xl border border-amber-400/30 bg-amber-500/10 p-4">
          <p class="text-sm font-semibold text-amber-100">Tutor Account</p>
          <p class="mt-1 text-xs text-amber-200">Requires admin approval before tutor dashboard access is enabled.</p>
        </div>
      </div>

      <div class="mt-8 rounded-xl border border-sky-400/30 bg-sky-500/10 p-4">
        <p class="text-xs font-semibold uppercase tracking-wide text-sky-200">Security</p>
        <p class="mt-1 text-xs text-sky-100">Use a strong password with upper/lowercase letters, numbers, and symbols.</p>
      </div>
    </aside>

    <main class="dark-card rounded-2xl border border-white/10 p-6 sm:p-8 lg:col-span-3">
      <div class="mb-6">
        <h2 class="text-2xl font-bold text-white">Create Your Account</h2>
        <p class="mt-1 text-sm text-slate-400">Start in less than a minute.</p>
      </div>

      {% if form.non_field_errors %}
      <div class="mb-4 rounded-xl border border-red-400/40 bg-red-500/10 px-4 py-3 text-sm text-red-100">
        {% for error in form.non_field_errors %}
          <p>{{ error }}</p>
        {% endfor %}
      </div>
      {% endif %}

      {% if form.errors %}
      <div class="mb-4 rounded-xl border border-red-400/40 bg-red-500/10 px-4 py-3 text-sm text-red-100">
        <p class="font-semibold">Please correct the highlighted fields.</p>
      </div>
      {% endif %}

      <form method="post" class="space-y-5" autocomplete="off" novalidate>
        {% csrf_token %}

        <div>
          <label class="mb-2 block text-sm font-semibold text-slate-200">Username</label>
          <div class="relative">
            <i class="ri-at-line absolute left-3 top-1/2 -translate-y-1/2 text-slate-500"></i>
            {{ form.username|add_attr:"autocomplete=off,autocapitalize=none,spellcheck=false"|add_class:"w-full rounded-xl border border-slate-600 bg-slate-900/70 py-3 pl-10 pr-3 text-sm text-white placeholder:text-slate-500 focus:border-sky-400 focus:outline-none" }}
          </div>
          {% if form.username.errors %}
            <p class="mt-1 text-xs text-red-300">{{ form.username.errors.0 }}</p>
          {% endif %}
        </div>

        <div>
          <label class="mb-2 block text-sm font-semibold text-slate-200">Email</label>
          <div class="relative">
            <i class="ri-mail-line absolute left-3 top-1/2 -translate-y-1/2 text-slate-500"></i>
            {{ form.email|add_attr:"autocomplete=email"|add_class:"w-full rounded-xl border border-slate-600 bg-slate-900/70 py-3 pl-10 pr-3 text-sm text-white placeholder:text-slate-500 focus:border-sky-400 focus:outline-none" }}
          </div>
          {% if form.email.errors %}
            <p class="mt-1 text-xs text-red-300">{{ form.email.errors.0 }}</p>
          {% endif %}
        </div>

        <div>
          <label class="mb-2 block text-sm font-semibold text-slate-200">Choose Your Role</label>
          <div class="grid gap-3 sm:grid-cols-2" id="roleCards">
            {% for radio in form.role %}
            <label for="{{ radio.id_for_label }}" class="role-card cursor-pointer rounded-xl border border-slate-600/70 bg-slate-900/50 p-4 transition hover:border-sky-400/60">
              <div class="flex items-start gap-3">
                {{ radio.tag }}
                <div>
                  <p class="text-sm font-semibold text-slate-100">{{ radio.choice_label }}</p>
                  <p class="mt-1 text-xs text-slate-400">
                    {% if radio.choice_label == 'Student' %}
                      Practice and track your placement preparation.
                    {% else %}
                      Create and review learning content after admin approval.
                    {% endif %}
                  </p>
                </div>
              </div>
            </label>
            {% endfor %}
          </div>
          {% if form.role.errors %}
            <p class="mt-1 text-xs text-red-300">{{ form.role.errors.0 }}</p>
          {% endif %}
          <p class="mt-2 text-xs text-amber-200">Tutor accounts are created immediately but remain pending until approved by admin.</p>
        </div>

        <div class="grid gap-5 sm:grid-cols-2">
          <div>
            <label class="mb-2 block text-sm font-semibold text-slate-200">Password</label>
            <div class="relative">
              <i class="ri-lock-line absolute left-3 top-1/2 -translate-y-1/2 text-slate-500"></i>
              {{ form.password1|add_attr:"autocomplete=new-password"|add_class:"w-full rounded-xl border border-slate-600 bg-slate-900/70 py-3 pl-10 pr-10 text-sm text-white placeholder:text-slate-500 focus:border-sky-400 focus:outline-none" }}
              <button type="button" class="absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 hover:text-slate-200" data-toggle-password="id_password1">
                <i class="ri-eye-line"></i>
              </button>
            </div>
            {% if form.password1.errors %}
              <p class="mt-1 text-xs text-red-300">{{ form.password1.errors.0 }}</p>
            {% endif %}
          </div>

          <div>
            <label class="mb-2 block text-sm font-semibold text-slate-200">Confirm Password</label>
            <div class="relative">
              <i class="ri-shield-check-line absolute left-3 top-1/2 -translate-y-1/2 text-slate-500"></i>
              {{ form.password2|add_attr:"autocomplete=new-password"|add_class:"w-full rounded-xl border border-slate-600 bg-slate-900/70 py-3 pl-10 pr-10 text-sm text-white placeholder:text-slate-500 focus:border-sky-400 focus:outline-none" }}
              <button type="button" class="absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 hover:text-slate-200" data-toggle-password="id_password2">
                <i class="ri-eye-line"></i>
              </button>
            </div>
            {% if form.password2.errors %}
              <p class="mt-1 text-xs text-red-300">{{ form.password2.errors.0 }}</p>
            {% endif %}
          </div>
        </div>

        <button type="submit" class="w-full rounded-xl bg-gradient-to-r from-sky-600 to-teal-600 px-4 py-3 text-sm font-semibold text-white hover:from-sky-700 hover:to-teal-700 transition">
          Create Account
        </button>
      </form>

      <p class="mt-5 text-center text-sm text-slate-400">
        Already have an account?
        <a href="{% url 'login' %}" class="font-semibold text-sky-300 hover:text-sky-200">Sign in</a>
      </p>
    </main>
  </div>
</section>

<script>
(function () {
  const passwordToggles = document.querySelectorAll('[data-toggle-password]');
  passwordToggles.forEach((btn) => {
    btn.addEventListener('click', () => {
      const target = document.getElementById(btn.dataset.togglePassword);
      if (!target) return;
      const icon = btn.querySelector('i');
      const isPassword = target.type === 'password';
      target.type = isPassword ? 'text' : 'password';
      icon.className = isPassword ? 'ri-eye-off-line' : 'ri-eye-line';
    });
  });

  const roleCards = document.querySelectorAll('.role-card');
  const roleInputs = document.querySelectorAll('input[name="role"]');
  function refreshRoleUI() {
    roleCards.forEach((card) => card.classList.remove('border-emerald-400/70', 'bg-emerald-500/10'));
    roleInputs.forEach((input) => {
      if (input.checked) {
        const card = input.closest('.role-card');
        if (card) {
          card.classList.add('border-emerald-400/70', 'bg-emerald-500/10');
        }
      }
    });
  }
  roleInputs.forEach((input) => input.addEventListener('change', refreshRoleUI));
  refreshRoleUI();
})();
</script>
{% endblock %}
