{% extends "base.html" %}
{% load static %}

{% block title %}Admin Dashboard | MockMate{% endblock %}

{% block content %}
<div class="min-h-screen py-12 px-4 sm:px-6 lg:px-8">
  <div class="max-w-7xl mx-auto">
    
    <!-- Header Section -->
    <div class="mb-12">
      <div class="flex items-center justify-between">
        <div>
          <h1 class="text-5xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-red-400 via-rose-400 to-pink-400 brand-font mb-3">
            Admin Dashboard
          </h1>
          <p class="text-slate-400 text-lg font-medium">Manage tutors, problems, and platform content</p>
        </div>
        <div class="hidden md:flex items-center space-x-4">
          <a href="/admin/" class="px-6 py-3 bg-gradient-to-r from-slate-700 to-slate-800 text-white rounded-xl hover:from-slate-600 hover:to-slate-700 transition-all duration-200 font-medium shadow-lg hover-lift">
            <i class="ri-settings-3-line mr-2"></i>Django Admin
          </a>
        </div>
      </div>
    </div>

    <!-- Stats Overview Cards -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12">
      <!-- Pending Tutors Stat -->
      <div class="dark-card rounded-2xl p-6 hover-lift">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-slate-400 text-sm font-medium uppercase tracking-wide mb-1">Pending Tutors</p>
            <p class="text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-cyan-400">
              {{ pending_tutors.count }}
            </p>
          </div>
          <div class="w-16 h-16 bg-gradient-to-br from-blue-500/20 to-cyan-500/20 rounded-2xl flex items-center justify-center">
            <i class="ri-user-add-line text-3xl text-blue-400"></i>
          </div>
        </div>
      </div>

      <!-- Pending Problems Stat -->
      <div class="dark-card rounded-2xl p-6 hover-lift">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-slate-400 text-sm font-medium uppercase tracking-wide mb-1">Inactive Problems</p>
            <p class="text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-yellow-400 to-orange-400">
              {{ pending_problems.count }}
            </p>
          </div>
          <div class="w-16 h-16 bg-gradient-to-br from-yellow-500/20 to-orange-500/20 rounded-2xl flex items-center justify-center">
            <i class="ri-code-box-line text-3xl text-yellow-400"></i>
          </div>
        </div>
      </div>

      <!-- Pending Articles Stat -->
      <div class="dark-card rounded-2xl p-6 hover-lift">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-slate-400 text-sm font-medium uppercase tracking-wide mb-1">Pending Articles</p>
            <p class="text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-pink-400">
              {{ pending_articles.count }}
            </p>
          </div>
          <div class="w-16 h-16 bg-gradient-to-br from-purple-500/20 to-pink-500/20 rounded-2xl flex items-center justify-center">
            <i class="ri-article-line text-3xl text-purple-400"></i>
          </div>
        </div>
      </div>
    </div>

    <!-- Main Content Grid -->
    <div class="grid grid-cols-1 xl:grid-cols-3 gap-8">
      
      <!-- Pending Tutors Section -->
      <div class="dark-card rounded-2xl p-8 hover-lift">
        <div class="flex items-center justify-between mb-6">
          <div class="flex items-center">
            <div class="w-12 h-12 bg-gradient-to-br from-blue-500/20 to-cyan-500/20 rounded-xl flex items-center justify-center mr-4">
              <i class="ri-user-add-line text-2xl text-blue-400"></i>
            </div>
            <div>
              <h2 class="text-2xl font-bold text-slate-100 brand-font">Pending Tutors</h2>
              <p class="text-sm text-slate-400">Awaiting approval</p>
            </div>
          </div>
        </div>

        {% if pending_tutors %}
          <div class="space-y-4 max-h-[600px] overflow-y-auto pr-2 custom-scrollbar">
            {% for user_profile in pending_tutors %}
              <div class="glass rounded-xl p-5 hover:bg-white/10 transition-all duration-200 border border-slate-700/50">
                <div class="flex items-start justify-between mb-4">
                  <div class="flex items-center space-x-3">
                    {% if user_profile.avatar %}
                      <img src="{{ user_profile.avatar.url }}" alt="{{ user_profile.user.username }}" class="w-12 h-12 rounded-full object-cover ring-2 ring-blue-400/30">
                    {% else %}
                      <div class="w-12 h-12 rounded-full bg-gradient-to-br from-blue-500 to-cyan-500 flex items-center justify-center text-white font-bold text-lg">
                        {{ user_profile.user.username|slice:":1"|upper }}
                      </div>
                    {% endif %}
                    <div>
                      <p class="font-semibold text-slate-100 text-lg">{{ user_profile.user.username }}</p>
                      <p class="text-sm text-slate-400">{{ user_profile.user.email }}</p>
                    </div>
                  </div>
                </div>
                
                {% if user_profile.bio %}
                  <p class="text-sm text-slate-300 mb-4 line-clamp-2">{{ user_profile.bio }}</p>
                {% endif %}

                <div class="flex items-center space-x-2 mb-4">
                  {% if user_profile.github %}
                    <a href="{{ user_profile.github }}" target="_blank" class="text-slate-400 hover:text-blue-400 transition-colors">
                      <i class="ri-github-fill text-lg"></i>
                    </a>
                  {% endif %}
                  {% if user_profile.linkedin %}
                    <a href="{{ user_profile.linkedin }}" target="_blank" class="text-slate-400 hover:text-blue-400 transition-colors">
                      <i class="ri-linkedin-fill text-lg"></i>
                    </a>
                  {% endif %}
                  <span class="text-xs text-slate-500 ml-auto">
                    <i class="ri-time-line mr-1"></i>{{ user_profile.created_at|timesince }} ago
                  </span>
                </div>

                <div class="flex space-x-2">
                  <a href="{% url 'users:approve_tutor' user_profile.user.id %}"
                     class="flex-1 px-4 py-2.5 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all text-sm font-semibold text-center shadow-md hover-lift">
                    <i class="ri-check-line mr-1"></i>Approve
                  </a>
                  <a href="{% url 'users:public_profile' user_profile.user.username %}"
                     class="px-4 py-2.5 glass border border-slate-600 text-slate-300 rounded-lg hover:bg-white/10 transition-all text-sm font-medium hover-lift">
                    <i class="ri-eye-line"></i>
                  </a>
                </div>
              </div>
            {% endfor %}
          </div>
        {% else %}
          <div class="text-center py-12">
            <div class="w-24 h-24 bg-gradient-to-br from-blue-500/10 to-cyan-500/10 rounded-full flex items-center justify-center mx-auto mb-4">
              <i class="ri-user-add-line text-5xl text-blue-400/50"></i>
            </div>
            <p class="text-slate-400 font-medium">No tutor accounts pending approval</p>
            <p class="text-sm text-slate-500 mt-2">New tutor registrations will appear here</p>
          </div>
        {% endif %}
      </div>

      <!-- Pending Problems Section -->
      <div class="dark-card rounded-2xl p-8 hover-lift">
        <div class="flex items-center justify-between mb-6">
          <div class="flex items-center">
            <div class="w-12 h-12 bg-gradient-to-br from-yellow-500/20 to-orange-500/20 rounded-xl flex items-center justify-center mr-4">
              <i class="ri-code-box-line text-2xl text-yellow-400"></i>
            </div>
            <div>
              <h2 class="text-2xl font-bold text-slate-100 brand-font">Inactive Problems</h2>
              <p class="text-sm text-slate-400">Need activation</p>
            </div>
          </div>
        </div>

        {% if pending_problems %}
          <div class="space-y-4 max-h-[600px] overflow-y-auto pr-2 custom-scrollbar">
            {% for problem in pending_problems %}
              <div class="glass rounded-xl p-5 hover:bg-white/10 transition-all duration-200 border border-slate-700/50">
                <div class="flex items-start justify-between mb-3">
                  <div class="flex-1">
                    <a href="{% url 'practice:problem_detail' problem.slug %}" 
                       class="font-semibold text-blue-400 hover:text-blue-300 text-lg line-clamp-2 transition-colors">
                      {{ problem.title }}
                    </a>
                    <div class="flex items-center space-x-3 mt-2">
                      <span class="px-2 py-1 text-xs font-medium rounded-lg
                        {% if problem.difficulty == 'EASY' %}bg-green-500/20 text-green-400
                        {% elif problem.difficulty == 'MEDIUM' %}bg-yellow-500/20 text-yellow-400
                        {% else %}bg-red-500/20 text-red-400{% endif %}">
                        {{ problem.get_difficulty_display }}
                      </span>
                      <span class="text-xs text-slate-500">
                        #{{ problem.problem_number }}
                      </span>
                    </div>
                  </div>
                </div>

                <div class="flex items-center text-sm text-slate-400 mb-4">
                  <i class="ri-user-line mr-2"></i>
                  <span>{{ problem.created_by.username }}</span>
                  <span class="mx-2">•</span>
                  <i class="ri-calendar-line mr-2"></i>
                  <span>{{ problem.created_at|date:"M d, Y" }}</span>
                </div>

                {% if problem.topics.exists %}
                  <div class="flex flex-wrap gap-2 mb-4">
                    {% for topic in problem.topics.all|slice:":3" %}
                      <span class="px-2 py-1 bg-indigo-500/10 text-indigo-400 text-xs rounded-lg border border-indigo-500/20">
                        {{ topic.name }}
                      </span>
                    {% endfor %}
                    {% if problem.topics.count > 3 %}
                      <span class="px-2 py-1 bg-slate-700/50 text-slate-400 text-xs rounded-lg">
                        +{{ problem.topics.count|add:"-3" }}
                      </span>
                    {% endif %}
                  </div>
                {% endif %}

                <div class="flex space-x-2">
                  <a href="{% url 'practice:admin_activate_problem' problem.slug %}"
                     class="flex-1 px-4 py-2.5 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all text-sm font-semibold text-center shadow-md hover-lift">
                    <i class="ri-check-line mr-1"></i>Activate
                  </a>
                  <a href="{% url 'practice:problem_detail' problem.slug %}"
                     class="px-4 py-2.5 glass border border-slate-600 text-slate-300 rounded-lg hover:bg-white/10 transition-all text-sm font-medium hover-lift">
                    <i class="ri-eye-line"></i>
                  </a>
                </div>
              </div>
            {% endfor %}
          </div>
        {% else %}
          <div class="text-center py-12">
            <div class="w-24 h-24 bg-gradient-to-br from-yellow-500/10 to-orange-500/10 rounded-full flex items-center justify-center mx-auto mb-4">
              <i class="ri-code-box-line text-5xl text-yellow-400/50"></i>
            </div>
            <p class="text-slate-400 font-medium">No inactive problems</p>
            <p class="text-sm text-slate-500 mt-2">All problems are currently active</p>
          </div>
        {% endif %}
      </div>

      <!-- Pending Articles Section -->
      <div class="dark-card rounded-2xl p-8 hover-lift">
        <div class="flex items-center justify-between mb-6">
          <div class="flex items-center">
            <div class="w-12 h-12 bg-gradient-to-br from-purple-500/20 to-pink-500/20 rounded-xl flex items-center justify-center mr-4">
              <i class="ri-article-line text-2xl text-purple-400"></i>
            </div>
            <div>
              <h2 class="text-2xl font-bold text-slate-100 brand-font">Pending Articles</h2>
              <p class="text-sm text-slate-400">Awaiting review</p>
            </div>
          </div>
        </div>

        {% if pending_articles %}
          <div class="space-y-4 max-h-[600px] overflow-y-auto pr-2 custom-scrollbar">
            {% for article in pending_articles %}
              <div class="glass rounded-xl p-5 hover:bg-white/10 transition-all duration-200 border border-slate-700/50">
                <div class="flex items-start justify-between mb-3">
                  <div class="flex-1">
                    <a href="{% url 'articles:article_detail' article.slug %}" 
                       class="font-semibold text-purple-400 hover:text-purple-300 text-lg line-clamp-2 transition-colors">
                      {{ article.title }}
                    </a>
                  </div>
                </div>

                <div class="flex items-center text-sm text-slate-400 mb-4">
                  <i class="ri-user-line mr-2"></i>
                  <span>{{ article.created_by.username }}</span>
                  <span class="mx-2">•</span>
                  <i class="ri-calendar-line mr-2"></i>
                  <span>{{ article.created_at|date:"M d, Y" }}</span>
                </div>

                <div class="flex space-x-2">
                  <a href="{% url 'articles:admin_article_approval' article.slug 'publish' %}"
                     class="flex-1 px-4 py-2.5 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all text-sm font-semibold text-center shadow-md hover-lift">
                    <i class="ri-check-line mr-1"></i>Publish
                  </a>
                  <a href="{% url 'articles:admin_article_approval' article.slug 'reject' %}"
                     class="px-4 py-2.5 bg-red-500/20 text-red-400 rounded-lg hover:bg-red-500/30 transition-all text-sm font-medium hover-lift">
                    <i class="ri-close-line"></i>
                  </a>
                  <a href="{% url 'articles:article_detail' article.slug %}"
                     class="px-4 py-2.5 glass border border-slate-600 text-slate-300 rounded-lg hover:bg-white/10 transition-all text-sm font-medium hover-lift">
                    <i class="ri-eye-line"></i>
                  </a>
                </div>
              </div>
            {% endfor %}
          </div>
        {% else %}
          <div class="text-center py-12">
            <div class="w-24 h-24 bg-gradient-to-br from-purple-500/10 to-pink-500/10 rounded-full flex items-center justify-center mx-auto mb-4">
              <i class="ri-article-line text-5xl text-purple-400/50"></i>
            </div>
            <p class="text-slate-400 font-medium">No articles pending approval</p>
            <p class="text-sm text-slate-500 mt-2">New article submissions will appear here</p>
          </div>
        {% endif %}
      </div>

    </div>

    <!-- Quick Actions Section -->
    <div class="mt-12">
      <h3 class="text-2xl font-bold text-slate-100 mb-6 brand-font">Quick Actions</h3>
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
        <a href="/admin/auth/user/" class="dark-card rounded-xl p-6 hover:bg-white/10 transition-all duration-200 hover-lift group">
          <div class="flex items-center space-x-4">
            <div class="w-12 h-12 bg-gradient-to-br from-blue-500/20 to-cyan-500/20 rounded-xl flex items-center justify-center group-hover:scale-110 transition-transform">
              <i class="ri-group-line text-2xl text-blue-400"></i>
            </div>
            <div>
              <p class="font-semibold text-slate-100">Manage Users</p>
              <p class="text-sm text-slate-400">View all users</p>
            </div>
          </div>
        </a>

        <a href="/admin/practice/problem/" class="dark-card rounded-xl p-6 hover:bg-white/10 transition-all duration-200 hover-lift group">
          <div class="flex items-center space-x-4">
            <div class="w-12 h-12 bg-gradient-to-br from-yellow-500/20 to-orange-500/20 rounded-xl flex items-center justify-center group-hover:scale-110 transition-transform">
              <i class="ri-code-s-slash-line text-2xl text-yellow-400"></i>
            </div>
            <div>
              <p class="font-semibold text-slate-100">All Problems</p>
              <p class="text-sm text-slate-400">Manage problems</p>
            </div>
          </div>
        </a>

        <a href="/admin/" class="dark-card rounded-xl p-6 hover:bg-white/10 transition-all duration-200 hover-lift group">
          <div class="flex items-center space-x-4">
            <div class="w-12 h-12 bg-gradient-to-br from-red-500/20 to-rose-500/20 rounded-xl flex items-center justify-center group-hover:scale-110 transition-transform">
              <i class="ri-settings-3-line text-2xl text-red-400"></i>
            </div>
            <div>
              <p class="font-semibold text-slate-100">Admin Panel</p>
              <p class="text-sm text-slate-400">Full control</p>
            </div>
          </div>
        </a>

        <a href="{% url 'users:admin_users' %}" class="dark-card rounded-xl p-6 hover:bg-white/10 transition-all duration-200 hover-lift group">
          <div class="flex items-center space-x-4">
            <div class="w-12 h-12 bg-gradient-to-br from-emerald-500/20 to-teal-500/20 rounded-xl flex items-center justify-center group-hover:scale-110 transition-transform">
              <i class="ri-user-settings-line text-2xl text-emerald-400"></i>
            </div>
            <div>
              <p class="font-semibold text-slate-100">User Settings</p>
              <p class="text-sm text-slate-400">Configure users</p>
            </div>
          </div>
        </a>
      </div>
    </div>

  </div>
</div>

<style>
  /* Custom scrollbar for the overflow sections */
  .custom-scrollbar::-webkit-scrollbar {
    width: 6px;
  }
  
  .custom-scrollbar::-webkit-scrollbar-track {
    background: rgba(255, 255, 255, 0.05);
    border-radius: 10px;
  }
  
  .custom-scrollbar::-webkit-scrollbar-thumb {
    background: linear-gradient(45deg, #6366f1, #8b5cf6);
    border-radius: 10px;
  }
  
  .custom-scrollbar::-webkit-scrollbar-thumb:hover {
    background: linear-gradient(45deg, #4f46e5, #7c3aed);
  }

  /* Line clamp utility */
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>
{% endblock %}