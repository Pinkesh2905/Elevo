{% extends "base.html" %}
{% load static %}

{% block title %}Interview Performance Report{% endblock %}

{% block content %}
<section class="min-h-screen bg-gradient-to-br from-slate-950 via-slate-900 to-emerald-950 px-4 py-8">
  <div class="mx-auto max-w-6xl space-y-6">
    <header class="rounded-2xl border border-white/10 bg-slate-900/80 p-6 backdrop-blur">
      <div class="flex flex-wrap items-start justify-between gap-4">
        <div>
          <p class="text-xs uppercase tracking-[0.2em] text-cyan-300">Performance Report</p>
          <h1 class="mt-1 text-2xl font-bold text-slate-100">{{ session.job_role|default:"Interview" }}</h1>
          <p class="text-sm text-slate-400">{{ session.start_time|date:"F j, Y g:i A" }}</p>
        </div>
        <div class="rounded-xl border border-cyan-500/40 bg-cyan-500/15 px-5 py-3 text-center">
          <p class="text-xs text-cyan-200">Overall Score</p>
          <p class="text-3xl font-semibold text-white">{{ ai_feedback.overall_score }}%</p>
        </div>
      </div>
    </header>

    <div class="grid gap-4 md:grid-cols-4">
      <article class="rounded-xl border border-white/10 bg-slate-900/80 p-4">
        <p class="text-xs text-slate-400">Communication</p>
        <p class="mt-1 text-xl font-semibold text-slate-100">{{ ai_feedback.communication_score }}%</p>
      </article>
      <article class="rounded-xl border border-white/10 bg-slate-900/80 p-4">
        <p class="text-xs text-slate-400">Confidence</p>
        <p class="mt-1 text-xl font-semibold text-slate-100">{{ ai_feedback.confidence_level }}</p>
      </article>
      <article class="rounded-xl border border-white/10 bg-slate-900/80 p-4">
        <p class="text-xs text-slate-400">Avg Answer Quality</p>
        <p class="mt-1 text-xl font-semibold text-slate-100">{{ interview_metrics.avg_answer_quality|default:"N/A" }}</p>
      </article>
      <article class="rounded-xl border border-white/10 bg-slate-900/80 p-4">
        <p class="text-xs text-slate-400">Duration</p>
        <p class="mt-1 text-xl font-semibold text-slate-100">{{ interview_metrics.duration_minutes|default:"N/A" }}{% if interview_metrics.duration_minutes %} min{% endif %}</p>
      </article>
    </div>

    <div class="grid gap-4 lg:grid-cols-2">
      <article class="rounded-2xl border border-white/10 bg-slate-900/80 p-5">
        <h2 class="text-lg font-semibold text-emerald-300">Strengths</h2>
        <ul class="mt-3 space-y-2">
          {% for item in ai_feedback.strengths %}
            <li class="rounded-lg border border-emerald-500/30 bg-emerald-500/10 px-3 py-2 text-sm text-slate-100">{{ item }}</li>
          {% endfor %}
        </ul>
      </article>

      <article class="rounded-2xl border border-white/10 bg-slate-900/80 p-5">
        <h2 class="text-lg font-semibold text-amber-300">Improvement Focus</h2>
        <ul class="mt-3 space-y-2">
          {% for item in ai_feedback.areas_for_improvement %}
            <li class="rounded-lg border border-amber-500/30 bg-amber-500/10 px-3 py-2 text-sm text-slate-100">{{ item }}</li>
          {% endfor %}
        </ul>
      </article>
    </div>

    <article class="rounded-2xl border border-white/10 bg-slate-900/80 p-5">
      <h2 class="text-lg font-semibold text-slate-100">Execution Guidance</h2>
      <ol class="mt-3 list-decimal space-y-2 pl-5 text-sm text-slate-200">
        {% for item in ai_feedback.recommendations %}
          <li class="rounded-lg border border-cyan-500/20 bg-cyan-500/10 px-3 py-2">{{ item }}</li>
        {% endfor %}
      </ol>
      <p class="mt-4 text-sm text-slate-200">{{ ai_feedback.technical_assessment }}</p>
      <p class="mt-2 text-sm text-cyan-300">{{ ai_feedback.encouragement_note }}</p>
    </article>

    <div class="grid gap-4 lg:grid-cols-2">
      <article class="rounded-2xl border border-white/10 bg-slate-900/80 p-5">
        <h2 class="text-sm font-semibold uppercase tracking-[0.15em] text-slate-300">Interview Stage Coverage</h2>
        <div class="mt-3 space-y-2">
          {% for stage, count in interview_metrics.stage_distribution.items %}
            <div>
              <div class="mb-1 flex justify-between text-xs text-slate-400">
                <span>{{ stage }}</span>
                <span>{{ count }}</span>
              </div>
              <div class="h-2 rounded-full bg-slate-800">
                <div class="h-2 rounded-full bg-gradient-to-r from-cyan-500 to-emerald-500" style="width: {% widthratio count interview_metrics.total_questions 100 %}%"></div>
              </div>
            </div>
          {% endfor %}
        </div>
      </article>

      <article class="rounded-2xl border border-white/10 bg-slate-900/80 p-5">
        <h2 class="text-sm font-semibold uppercase tracking-[0.15em] text-slate-300">Session Metrics</h2>
        <div class="mt-3 grid grid-cols-2 gap-3">
          <div class="rounded-lg bg-slate-800 p-3">
            <p class="text-xs text-slate-500">Questions</p>
            <p class="text-lg text-slate-100">{{ interview_metrics.total_questions }}</p>
          </div>
          <div class="rounded-lg bg-slate-800 p-3">
            <p class="text-xs text-slate-500">Total Words</p>
            <p class="text-lg text-slate-100">{{ interview_metrics.total_words }}</p>
          </div>
          <div class="rounded-lg bg-slate-800 p-3">
            <p class="text-xs text-slate-500">Avg Response</p>
            <p class="text-lg text-slate-100">{{ interview_metrics.avg_response_length }}</p>
          </div>
          <div class="rounded-lg bg-slate-800 p-3">
            <p class="text-xs text-slate-500">Engagement</p>
            <p class="text-lg text-slate-100">{{ interview_metrics.engagement_score }}%</p>
          </div>
        </div>
      </article>
    </div>

    <article class="rounded-2xl border border-white/10 bg-slate-900/80 p-5">
      <h2 class="text-lg font-semibold text-slate-100">Transcript</h2>
      <div class="mt-3 max-h-[460px] space-y-3 overflow-y-auto">
        {% for turn in turns %}
          {% if turn.ai_question %}
            <div class="rounded-lg border border-cyan-500/30 bg-cyan-500/10 px-3 py-2 text-sm text-slate-100">
              <p class="mb-1 text-xs font-semibold text-cyan-300">Elevo (Q{{ turn.turn_number }})</p>
              <p>{{ turn.ai_question }}</p>
            </div>
          {% endif %}
          {% if turn.user_answer %}
            <div class="rounded-lg border border-emerald-500/30 bg-emerald-500/10 px-3 py-2 text-sm text-slate-100">
              <p class="mb-1 text-xs font-semibold text-emerald-300">You</p>
              <p>{{ turn.user_answer }}</p>
            </div>
          {% endif %}
        {% endfor %}
      </div>
    </article>

    <footer class="flex flex-wrap gap-2">
      <a href="{% url 'mock_interview:my_mock_interviews' %}" class="rounded-lg border border-white/20 bg-white/5 px-4 py-2 text-slate-200 hover:bg-white/10">Back to History</a>
      <a href="{% url 'mock_interview:interview_setup' %}" class="rounded-lg bg-cyan-600 px-4 py-2 text-white hover:bg-cyan-500">Practice Again</a>
    </footer>
  </div>
</section>
{% endblock %}
