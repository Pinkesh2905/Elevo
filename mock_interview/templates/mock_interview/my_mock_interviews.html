{% extends "base.html" %}
{% load static %}
{% load custom_filters %}

{% block title %}Interview Command Center{% endblock %}

{% block content %}
<section class="min-h-screen bg-gradient-to-br from-slate-950 via-slate-900 to-sky-950 px-4 py-8">
  <div class="mx-auto max-w-6xl">
    <header class="mb-6 flex flex-wrap items-center justify-between gap-3">
      <div>
        <p class="text-xs uppercase tracking-[0.2em] text-cyan-300">Command Center</p>
        <h1 class="text-2xl font-bold text-slate-100">Mock Interview Sessions</h1>
        <p class="text-sm text-slate-400">Track performance progression across interviews.</p>
      </div>
      <div class="flex gap-2">
        <a href="{% url 'mock_interview:interview_setup' %}" class="rounded-lg bg-cyan-600 px-4 py-2 text-sm font-semibold text-white hover:bg-cyan-500">New Interview</a>
        {% if sessions %}
          <form method="post" action="{% url 'mock_interview:clear_all_sessions' %}">
            {% csrf_token %}
            <button type="submit" class="rounded-lg border border-red-500/50 bg-red-500/10 px-4 py-2 text-sm text-red-300 hover:bg-red-500/20">Clear All</button>
          </form>
        {% endif %}
      </div>
    </header>

    {% if sessions %}
      <div class="space-y-4">
        {% for session in sessions %}
          <article class="rounded-2xl border border-white/10 bg-slate-900/80 p-5 backdrop-blur">
            <div class="flex flex-wrap items-start justify-between gap-3">
              <div>
                <h2 class="text-lg font-semibold text-slate-100">{{ session.job_role|default:"Untitled Role" }}</h2>
                <p class="text-xs text-slate-500">{{ session.start_time|date:"F j, Y g:i A" }}</p>
                <div class="mt-2 flex flex-wrap gap-2 text-xs text-slate-300">
                  <span class="rounded bg-slate-800 px-2 py-1">Duration: {{ session.duration_display }}</span>
                  <span class="rounded bg-slate-800 px-2 py-1">Questions: {{ session.total_questions }}</span>
                  <span class="rounded bg-slate-800 px-2 py-1">Status: {{ session.status }}</span>
                </div>
              </div>
              <div class="text-right">
                <p class="text-xs text-slate-400">Overall</p>
                <p class="text-2xl font-semibold text-cyan-300">{% if session.score %}{{ session.score }}%{% else %}--{% endif %}</p>
              </div>
            </div>

            {% if session.key_skills %}
              <div class="mt-3 flex flex-wrap gap-2">
                {% for skill in session.key_skills|split:"," %}
                  <span class="rounded border border-cyan-500/30 bg-cyan-500/10 px-2 py-1 text-xs text-cyan-200">{{ skill|trim_whitespace }}</span>
                {% endfor %}
              </div>
            {% endif %}

            <div class="mt-4 grid gap-3 md:grid-cols-3">
              <div class="rounded-lg border border-white/10 bg-white/5 p-3">
                <p class="text-xs text-slate-500">Confidence</p>
                <p class="text-sm text-slate-100">{{ session.feedback_summary.confidence|default:"Pending" }}</p>
              </div>
              <div class="rounded-lg border border-white/10 bg-white/5 p-3">
                <p class="text-xs text-slate-500">Communication</p>
                <p class="text-sm text-slate-100">{% if session.feedback_summary.communication %}{{ session.feedback_summary.communication }}%{% else %}Pending{% endif %}</p>
              </div>
              <div class="rounded-lg border border-white/10 bg-white/5 p-3">
                <p class="text-xs text-slate-500">Top Strength</p>
                <p class="text-sm text-slate-100">{{ session.feedback_summary.top_strength|default:"Pending" }}</p>
              </div>
            </div>

            <footer class="mt-4 flex flex-wrap gap-2">
              {% if session.status == "STARTED" %}
                <a href="{% url 'mock_interview:main_interview' session_id=session.id %}" class="rounded-lg bg-cyan-600 px-4 py-2 text-sm text-white hover:bg-cyan-500">Continue</a>
              {% endif %}
              <a href="{% url 'mock_interview:review_interview' session_id=session.id %}" class="rounded-lg border border-white/20 bg-white/5 px-4 py-2 text-sm text-slate-200 hover:bg-white/10">View Report</a>
              <form method="post" action="{% url 'mock_interview:delete_session' session_id=session.id %}">
                {% csrf_token %}
                <button type="submit" class="rounded-lg border border-red-500/50 bg-red-500/10 px-4 py-2 text-sm text-red-300 hover:bg-red-500/20">Delete</button>
              </form>
            </footer>
          </article>
        {% endfor %}
      </div>
    {% else %}
      <div class="rounded-2xl border border-dashed border-white/20 bg-slate-900/80 p-10 text-center">
        <h2 class="text-xl font-semibold text-slate-100">No Interview Sessions Yet</h2>
        <p class="mt-2 text-sm text-slate-400">Start your first session to unlock role-based coaching and reports.</p>
        <a href="{% url 'mock_interview:interview_setup' %}" class="mt-4 inline-block rounded-lg bg-cyan-600 px-5 py-2 text-white hover:bg-cyan-500">Start Interview</a>
      </div>
    {% endif %}
  </div>
</section>
{% endblock %}
