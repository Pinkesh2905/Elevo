{% extends "base.html" %}

{% block title %}Interview Review Detail | Elevo{% endblock %}

{% block content %}
<div class="min-h-screen px-4 py-10 sm:px-6 lg:px-8">
  <div class="mx-auto max-w-6xl space-y-6">
    {% if messages %}
    <section class="space-y-3">
      {% for message in messages %}
      <div class="rounded-xl border px-4 py-3 text-sm {% if message.tags == 'success' %}border-emerald-400/40 bg-emerald-500/10 text-emerald-200{% elif message.tags == 'error' %}border-red-400/40 bg-red-500/10 text-red-200{% else %}border-sky-400/40 bg-sky-500/10 text-sky-200{% endif %}">
        {{ message }}
      </div>
      {% endfor %}
    </section>
    {% endif %}

    <section class="dark-card rounded-2xl border border-white/10 p-6 sm:p-8">
      <div class="flex flex-col gap-4 lg:flex-row lg:items-center lg:justify-between">
        <div>
          <p class="text-xs font-semibold uppercase tracking-[0.2em] text-sky-300">Tutor Review</p>
          <h1 class="mt-2 text-3xl font-bold text-white brand-font">Interview Session #{{ session.id }}</h1>
          <p class="mt-2 text-sm text-slate-300">Student: {{ session.user.username }} | Role: {{ session.job_role|default:'N/A' }}</p>
        </div>
        <a href="{% url 'tutor:mock_interview_review_list' %}" class="rounded-xl border border-slate-600 px-4 py-2 text-sm font-semibold text-slate-200 hover:bg-slate-800/60 transition">Back to Queue</a>
      </div>
    </section>

    <section class="grid grid-cols-1 gap-4 md:grid-cols-3">
      <article class="dark-card rounded-xl border border-white/10 p-5">
        <p class="text-xs uppercase tracking-wide text-slate-400">Total Questions</p>
        <p class="mt-2 text-3xl font-bold text-white">{{ interview_metrics.total_questions }}</p>
      </article>
      <article class="dark-card rounded-xl border border-white/10 p-5">
        <p class="text-xs uppercase tracking-wide text-slate-400">Answered</p>
        <p class="mt-2 text-3xl font-bold text-white">{{ interview_metrics.answered_questions }}</p>
      </article>
      <article class="dark-card rounded-xl border border-white/10 p-5">
        <p class="text-xs uppercase tracking-wide text-slate-400">Duration</p>
        <p class="mt-2 text-3xl font-bold text-white">{% if interview_metrics.duration_minutes %}{{ interview_metrics.duration_minutes }} min{% else %}N/A{% endif %}</p>
      </article>
    </section>

    <section class="grid grid-cols-1 gap-6 xl:grid-cols-3">
      <article class="dark-card rounded-2xl border border-white/10 p-6 xl:col-span-2">
        <h2 class="mb-4 text-xl font-semibold text-white">Interview Transcript</h2>
        <div class="space-y-4 max-h-[700px] overflow-y-auto pr-2">
          {% for turn in turns %}
          <div class="rounded-xl border border-slate-700/60 bg-slate-900/40 p-4">
            <p class="text-xs font-semibold uppercase tracking-wide text-sky-300">Question {{ turn.turn_number }}</p>
            <p class="mt-1 text-sm text-slate-100">{{ turn.ai_question }}</p>

            <div class="mt-3 rounded-lg border border-slate-700/60 bg-slate-950/40 p-3">
              <p class="text-xs font-semibold uppercase tracking-wide text-emerald-300">Student Answer</p>
              <p class="mt-1 text-sm text-slate-200">{{ turn.user_answer|default:'No answer provided' }}</p>
            </div>

            {% if turn.ai_follow_up_feedback %}
            <div class="mt-3 rounded-lg border border-amber-400/30 bg-amber-500/10 p-3">
              <p class="text-xs font-semibold uppercase tracking-wide text-amber-200">AI Feedback</p>
              <p class="mt-1 text-sm text-amber-100">{{ turn.ai_follow_up_feedback }}</p>
            </div>
            {% endif %}
          </div>
          {% empty %}
          <p class="text-sm text-slate-400">No interview turns were recorded.</p>
          {% endfor %}
        </div>
      </article>

      <article class="dark-card rounded-2xl border border-white/10 p-6 xl:col-span-1">
        <h2 class="mb-4 text-xl font-semibold text-white">Tutor Feedback</h2>
        <form method="post" class="space-y-4">
          {% csrf_token %}

          <div>
            <label class="mb-2 block text-xs font-semibold uppercase tracking-wide text-slate-400">Tutor Notes</label>
            <textarea name="tutor_feedback" rows="8" class="w-full rounded-xl border border-slate-600/60 bg-slate-900/60 px-4 py-3 text-sm text-white placeholder-slate-400 focus:border-sky-400 focus:outline-none">{{ session.overall_feedback|default:'' }}</textarea>
          </div>

          <div>
            <label class="mb-2 block text-xs font-semibold uppercase tracking-wide text-slate-400">Score (0-100)</label>
            <input type="number" name="tutor_score" min="0" max="100" step="0.01" value="{{ session.score|default:'' }}" class="w-full rounded-xl border border-slate-600/60 bg-slate-900/60 px-4 py-2.5 text-sm text-white focus:border-sky-400 focus:outline-none">
          </div>

          <div>
            <label class="mb-2 block text-xs font-semibold uppercase tracking-wide text-slate-400">Status</label>
            <select name="status" class="w-full rounded-xl border border-slate-600/60 bg-slate-900/60 px-3 py-2.5 text-sm text-white focus:border-sky-400 focus:outline-none">
              <option value="REVIEW_PENDING" {% if session.status == 'REVIEW_PENDING' %}selected{% endif %}>Review Pending</option>
              <option value="REVIEWED" {% if session.status == 'REVIEWED' %}selected{% endif %}>Reviewed</option>
              <option value="COMPLETED" {% if session.status == 'COMPLETED' %}selected{% endif %}>Completed</option>
            </select>
          </div>

          <button type="submit" class="w-full rounded-xl bg-gradient-to-r from-emerald-500 to-teal-600 px-4 py-2.5 text-sm font-semibold text-white hover:from-emerald-600 hover:to-teal-700 transition">
            Save Review
          </button>
        </form>
      </article>
    </section>
  </div>
</div>
{% endblock %}
